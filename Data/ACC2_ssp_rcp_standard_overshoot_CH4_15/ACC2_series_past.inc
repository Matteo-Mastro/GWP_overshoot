********** ACC2 version 4.2: ACC2_series_past.inc **********************************************************************
********** Additional codes to run a series of inversions (past mode) ==================================================

SET X            Index for sensitivity analysis
                 /1*21/;

PARAMETERS

CFREC(X)

CO2FFRESSUMREC(X)
CO2LURESSUMREC(X)
ANTRESSUMCH4REC(X)
ANTRESSUMN2OREC(X)
RADMISRESSUMREC(X)

TMIX1750RESSUMREC(X)
DMPTMIXRESSUMREC(X)
BETARESSUMREC(X)
Q10BASRESSUMREC(X)
Q10TMPRESSUMREC(X)
TNPPSENSRESSUMREC(X)
CO2OCNUPPRERESSUMREC(X)
CO2LNDUPPRERESSUMREC(X)
NATCH4RESSUMREC(X)
NATN2ORESSUMREC(X)
TAUCH4OHRESSUMREC(X)
TAUN2ORESSUMREC(X)
RAD2XCO2RESSUMREC(X)
SCLRADRESSUMREC(X)
SENSRESSUMREC(X)
KAPPARESSUMREC(X)
RADMISAR1PRORESSUMREC(X)
T2MAR1PRORESSUMREC(X)

CO2OCNUPANTRESSUMREC(X)
CO2LNDUPANTRESSUMREC(X)
CONCO2RESSUMREC(X)
CONCH4RESSUMREC(X)
CONN2ORESSUMREC(X)
T2MRESSUMREC(X)

TMIX1750REC(X)
DMPTMIXREC(X)
BETAREC(X)
Q10BASREC(X)
Q10TMPREC(X)
TNPPSENSREC(X)
CO2OCNUPPREREC(X)
CO2LNDUPPREREC(X)
NATCH4REC(X)
NATN2OREC(X)
TAUCH4OHREC(X)
TAUN2OREC(X)
RAD2XCO2REC(X)
SCLRADREC(X)
SENSREC(X)
KAPPAREC(X)
RADMISAR1PROREC(X)
T2MAR1PROREC(X)

RADAERAVEREC(X)
RADMISAVEREC(X)
YINTRCO2ENSOREC(X)
SLOPECO2ENSOREC(X)
RSQ1REC(X)
RSQ2REC(X)
T2MPRI1750REC(X)

MODELSTATREC(X)
SOLVESTATREC(X)
NUMEQUREC(X)
NUMINFESREC(X)
NUMNOPTREC(X)
NUMNZREC(X)
NUMVARREC(X)
ITERUSDREC(X)
RESUSDREC(X)

TENDINVAUX(X)
/1               151
 2               156
 3               161
 4               166
 5               171
 6               176
 7               181
 8               186
 9               191
 10              196
 11              201
 12              206
 13              211
 14              216
 15              221
 16              226
 17              231
 18              236
 19              241
 20              246
 21              251/;

$SET CONSOLE
$IF %SYSTEM.FILESYS% == UNIX  $SET CONSOLE /DEV/TTY
$IF %SYSTEM.FILESYS% == DOS $SET CONSOLE CON
$IF %SYSTEM.FILESYS% == MS95  $SET CONSOLE CON
$IF %SYSTEM.FILESYS% == MSNT  $SET CONSOLE CON
$IF "%CONSOLE%." == "." ABORT "FILESYS NOT RECOGNIZED";
FILE SCREEN / '%CONSOLE%' /;

LOOP (X,

TENDINV=TENDINVAUX(X);

* To pop up the screen, click Options --> Execute --> Minimized or Normal (DOS Windows)
PUT SCREEN;
PUT 'I am running for CS =' TENDINV;
PUTCLOSE;

OPTION SOLPRINT = off;
* Not to print the detailed solution information for equations and variables.
* Recommended for series of optimizations.

SOLVE PAST USING NLP MINIMIZING CF;

CFREC(X) = CF.L;

CO2FFRESSUMREC(X) = CO2FFRESSUM.L;
CO2LURESSUMREC(X) = CO2LURESSUM.L;
ANTRESSUMCH4REC(X) = ANTRESSUMCH4.L;
ANTRESSUMN2OREC(X) = ANTRESSUMN2O.L;
RADMISRESSUMREC(X) = RADMISRESSUM.L;

TMIX1750RESSUMREC(X) = TMIX1750RESSUM.L;
DMPTMIXRESSUMREC(X) = DMPTMIXRESSUM.L;
BETARESSUMREC(X) = BETARESSUM.L;
Q10BASRESSUMREC(X) = Q10BASRESSUM.L;
Q10TMPRESSUMREC(X) = Q10TMPRESSUM.L;
TNPPSENSRESSUMREC(X) = TNPPSENSRESSUM.L;
CO2OCNUPPRERESSUMREC(X) = CO2OCNUPPRERESSUM.L;
CO2LNDUPPRERESSUMREC(X) = CO2LNDUPPRERESSUM.L;
NATCH4RESSUMREC(X) = NATCH4RESSUM.L;
NATN2ORESSUMREC(X) = NATN2ORESSUM.L;
TAUCH4OHRESSUMREC(X) = TAUCH4OHRESSUM.L;
TAUN2ORESSUMREC(X) = TAUN2ORESSUM.L;
RAD2XCO2RESSUMREC(X) = RAD2XCO2RESSUM.L;
SCLRADRESSUMREC(X) = SCLRADRESSUM.L;
SENSRESSUMREC(X) = SENSRESSUM.L;
KAPPARESSUMREC(X) = KAPPARESSUM.L;
RADMISAR1PRORESSUMREC(X) = RADMISAR1PRORESSUM.L;
T2MAR1PRORESSUMREC(X) = T2MAR1PRORESSUM.L;

CO2OCNUPANTRESSUMREC(X) = CO2OCNUPANTRESSUM.L;
CO2LNDUPANTRESSUMREC(X) = CO2LNDUPANTRESSUM.L;
CONCO2RESSUMREC(X) = CONCO2RESSUM.L;
CONCH4RESSUMREC(X) = CONCH4RESSUM.L;
CONN2ORESSUMREC(X) = CONN2ORESSUM.L;
T2MRESSUMREC(X) = T2MRESSUM.L;

TMIX1750REC(X) = TMIX1750.L;
DMPTMIXREC(X) = DMPTMIX.L;
BETAREC(X) = BETA.L('2000');
Q10BASREC(X) = Q10BAS.L;
Q10TMPREC(X) = Q10TMP.L;
TNPPSENSREC(X) = TNPPSENS.L;
CO2OCNUPPREREC(X) = CO2OCNUPPRE.L('2000');
CO2LNDUPPREREC(X) = CO2LNDUPPRE.L('2000');
NATCH4REC(X) = NATCH4.L;
NATN2OREC(X) = NATN2O.L;
TAUCH4OHREC(X) = TAUCH4OH.L;
TAUN2OREC(X) = TAUN2O.L;
RAD2XCO2REC(X) = RAD2XCO2.L;
SCLRADREC(X) = SCLRAD.L;
SENSREC(X) = SENS.L('2000');
KAPPAREC(X) = KAPPA.L;
RADMISAR1PROREC(X) = RADMISAR1PRO.L;
T2MAR1PROREC(X) = T2MAR1PRO.L;

RADAERAVEREC(X) = RADAERAVE.L;
RADMISAVEREC(X) = RADMISAVE.L;
YINTRCO2ENSOREC(X) = YINTRCO2ENSO.L;
SLOPECO2ENSOREC(X) = SLOPECO2ENSO.L;
RSQ1REC(X) = RSQ1.L;
RSQ2REC(X) = RSQ2.L;
T2MPRI1750REC(X) = T2MPRI.L('1750');

MODELSTATREC(X) = PAST.MODELSTAT;
SOLVESTATREC(X) = PAST.SOLVESTAT;
NUMEQUREC(X) = PAST.NUMEQU;
NUMINFESREC(X) = PAST.NUMINFES;
NUMNOPTREC(X) = PAST.NUMNOPT;
NUMNZREC(X) = PAST.NUMNZ;
NUMVARREC(X) = PAST.NUMVAR;
ITERUSDREC(X) = PAST.ITERUSD;
RESUSDREC(X) = PAST.RESUSD;

PUT SCREEN;
PUT 'MODELSTAT' PAST.MODELSTAT/;
PUT 'SOLVESTAT' PAST.SOLVESTAT/;
PUT 'CF' CF.l/;
PUTCLOSE;

);

*** File output to summarize the sensitivity analysis ------------------------------------------------------------------

FILE OUT_PAST_SENS /out_past_sens.dat/;
OUT_PAST_SENS.AP=0;
OUT_PAST_SENS.PW=1000;
PUT OUT_PAST_SENS;
PUT
'INDEX ',

'CF ',

'CO2FFRS ',
'CO2LURS ',
'ANTRS(CH4) ',
'ANTRS(N2O) ',
'RADMISRS ',

'TMIX1750RS ',
'DMPTMIXRS ',
'BETARS ',
'Q10BASRS ',
'Q10TMPRS ',
'TNPPSENSRS ',
'CO2OCNUPPRERS ',
'CO2LNDUPPRERS ',
'NATCH4RS ',
'NATN2ORS ',
'TAUCH4OHRS ',
'TAUN2ORS ',
'RAD2XCO2RS ',
'SCLRADRS ',
'SENSRS ',
'KAPPARS ',
'RADMISAR1PRORS ',
'T2MAR1PRORS ',

'CO2OCNUPANTRESSUM ',
'CO2LNDUPANTRESSUM ',
'CONCO2RESSUM ',
'CONCH4RESSUM ',
'CONN2ORESSUM ',
'T2MRESSUM ',

'TMIX1750 ',
'DMPTMIX ',
'BETA ',
'Q10BAS ',
'Q10TMP ',
'TNPPSENS ',
'CO2OCNUPPRE ',
'CO2LNDUPPRE ',
'NATCH4 ',
'NATN2O ',
'TAUCH4OH ',
'TAUN2O ',
'RAD2XCO2 ',
'SCLRAD ',
'SENS ',
'KAPPA ',
'RADMISAR1PRO ',
'T2MAR1PRO ',

'RADAERAVE ',
'RADMISAVE ',
'YINTRCO2ENSO ',
'SLOPECO2ENSO ',
'RSQ1 ',
'RSQ2 ',
'T2MPRI1750 ',

'MODELSTAT ',
'SOLVESTAT ',
'NUMEQU ',
'NUMINFES ',
'NUMNOPT ',
'NUMNZ ',
'NUMVAR ',
'ITERUSD ',
'RESUSD '/;

LOOP(X, PUT X.TL:4,
CFREC(X):10:3,

CO2FFRESSUMREC(X):10:3,
CO2LURESSUMREC(X):10:3,
ANTRESSUMCH4REC(X):10:3,
ANTRESSUMN2OREC(X):10:3,
RADMISRESSUMREC(X):10:3,

TMIX1750RESSUMREC(X):8:3,
DMPTMIXRESSUMREC(X):8:3,
BETARESSUMREC(X):8:3,
Q10BASRESSUMREC(X):8:3,
Q10TMPRESSUMREC(X):8:3,
TNPPSENSRESSUMREC(X):8:3,
CO2OCNUPPRERESSUMREC(X):10:3,
CO2LNDUPPRERESSUMREC(X):10:3,
NATCH4RESSUMREC(X):8:3,
NATN2ORESSUMREC(X):8:3,
TAUCH4OHRESSUMREC(X):8:3,
TAUN2ORESSUMREC(X):8:3,
RAD2XCO2RESSUMREC(X):8:3,
SCLRADRESSUMREC(X):8:3,
SENSRESSUMREC(X):8:3,
KAPPARESSUMREC(X):8:3,
RADMISAR1PRORESSUMREC(X):8:3,
T2MAR1PRORESSUMREC(X):8:3,

CO2OCNUPANTRESSUMREC(X):10:3,
CO2LNDUPANTRESSUMREC(X):10:3,
CONCO2RESSUMREC(X):10:3,
CONCH4RESSUMREC(X):10:3,
CONN2ORESSUMREC(X):10:3,
T2MRESSUMREC(X):10:3,

TMIX1750REC(X):12:6,
DMPTMIXREC(X):8:3,
BETAREC(X):8:3,
Q10BASREC(X):8:3,
Q10TMPREC(X):8:3,
TNPPSENSREC(X):8:3,
CO2OCNUPPREREC(X):8:3,
CO2LNDUPPREREC(X):8:3,
NATCH4REC(X):8:3,
NATN2OREC(X):8:3,
TAUCH4OHREC(X):8:3,
TAUN2OREC(X):8:3,
RAD2XCO2REC(X):8:3,
SCLRADREC(X):8:3,
SENSREC(X):8:3,
KAPPAREC(X):8:3,
RADMISAR1PROREC(X):8:3,
T2MAR1PROREC(X):8:3,

RADAERAVEREC(X):11:5,
RADMISAVEREC(X):11:5,
YINTRCO2ENSOREC(X):8:3,
SLOPECO2ENSOREC(X):8:3,
RSQ1REC(X):8:3,
RSQ2REC(X):8:3,
T2MPRI1750REC(X):8:3,

MODELSTATREC(X),
SOLVESTATREC(X),
NUMEQUREC(X),
NUMINFESREC(X),
NUMNOPTREC(X),
NUMNZREC(X),
NUMVARREC(X),
ITERUSDREC(X),
RESUSDREC(X)/;);
